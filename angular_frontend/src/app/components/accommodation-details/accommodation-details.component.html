<ng-container *ngIf="invalidAccommodation" id="invalid-accommodation-container">
    <h1 class="text-3xl text-orange-700">Error 404 Not Found: Invalid Accommodation ID Provided</h1>
  </ng-container>
  
  <ng-container *ngIf="invalidUserId || userNotLogged">
    <h1 class="text-3xl text-orange-700">Error 401 Unauthorized: Need to be Logged-in with a lecit account</h1>
  </ng-container>
  
  <ng-container *ngIf="!invalidAccommodation && !invalidUserId && !userNotLogged" id="accommodation-details-container">
    <div class="flex flex-col items-center justify-center">
      <div class="flex flex-row">
        <div class="mx-2 text-5xl">{{accommodation.title}}</div>
        <div id="heart">
          <img class="cursor-pointer w-7" *ngIf="isFavourite" src="/assets/icons/heart-full.png" (click)="toggleIsFavourite()" />
          <img class="cursor-pointer w-7" *ngIf="!isFavourite" src="/assets/icons/heart-empty.png" (click)="toggleIsFavourite()" />      
        </div>
        <div *ngIf="isAdminOrMe" id="bin-icon" class="absolute right-20">
          <img class="w-10 cursor-pointer" src="/assets/icons/bin.png" (click)="deleteAccommodation()" />
        </div>
      </div>
      <div class="flex flex-row">
        <div class="text-4xl">
          {{accommodation.city}}, {{accommodation.province}}, {{accommodation.country}}
        </div>
        <div class="mx-3" *ngIf="isAdminOrMe">
          <img class="cursor-pointer w-7" src="/assets/icons/pencil.png" (click)="toggleEditCityProvCountry()" />
        </div>
      </div>
      <div id="images" class="flex flex-row mt-8">

        <!-- TODO ALL IMAGES + CAROUSEL -->
        <!-- -------------------------------------------------------------------------------------- -->
        <img id="biggest-image" [src]="'assets/' + accommodation.photos[0].photo_url" class="w-80" />

        <img src="/assets/icons/pencil.png" (click)="toggleEditPhotosPerspective()" class="relative top-0 right-0 cursor-pointer w-7 h-7" *ngIf="accommodation.photos.length === 1" id="pencil-one-image" />
        
        <div *ngIf="accommodation.photos.length > 1" id="other-images" class="flex flex-col">
          <div class="flex flex-row">
            <img id="image-oth1" [src]="'assets/' + accommodation.photos[1].photo_url" class="w-80" />
            <img src="/assets/icons/pencil.png" (click)="toggleEditPhotosPerspective()" class="relative top-0 right-0 cursor-pointer w-7" *ngIf="accommodation.photos.length === 2" id="pencil-two-images" />
            <div>
              <img id="image-oth2" [src]="'assets/' + accommodation.photos[2].photo_url" class="w-80" *ngIf="accommodation.photos.length > 2" />
              <img src="/assets/icons/pencil.png" (click)="toggleEditPhotosPerspective()" *ngIf="accommodation.photos.length >= 3" id="pencil-three-images" class="relative top-0 right-0 cursor-pointer w-7" />
            </div>
          </div>

          <div class="flex flex-row" *ngIf="accommodation.photos.length > 3">
            <img id="image-oth3" [src]="'assets/' + accommodation.photos[3].photo_url" class="w-80" />
            <div>
              <img id="image-oth4" [src]="'assets/' + accommodation.photos[4].photo_url" class="w-80" *ngIf="accommodation.photos.length > 4" />
              <div class="absolute bottom-0 right-0 cursor-pointer" (click)="toggleViewMorePhotosPerspective()" *ngIf="accommodation.photos.length > 5">{{("accommodation-card-details.view-more-photos" | translate)}}</div>
            </div>
          </div>
        </div>
        <!-- -------------------------------------------------------------------------------------- -->
      </div>
      <div class="flex flex-row mt-8 border rounded-lg shadow-sm bg-neutral-1">
        <div class="text-4xl">
          {{accommodation.rooms}} {{"accommodation-card-details.rooms-word" | translate}}, {{accommodation.beds}} {{"accommodation-card-details.beds-word" | translate}}
        </div>
        <div class="mx-3" *ngIf="isAdminOrMe">
          <img class="cursor-pointer w-7" src="/assets/icons/pencil.png" (click)="toggleEditRoomsBeds()" />
        </div>
      </div>
      <p class="mt-10 text-3xl" *ngIf="isAdminOrMe && accommodation.approval_timestamp">{{("accommodation-card-details.approval-timestamp-text" | translate)}}: {{accommodation.approval_timestamp}}</p>
      
      <!-- HOST INFO SECTION -->
      <!-------------------------------------------------------------------------------------------------------------------------------------------------->
      <div id="host-info-div" class="mt-10 text-4xl">
        <div id="horizontal-flex" class="flex flex-row border rounded-lg shadow-sm bg-neutral-1">
          <div class="m-auto" id="profile-picture-and-badge">
            <img id="profile-picture" class="w-12" [src]="'/assets' + accommodationOwner.profilePictureUrl" class="w-44" />
            <!-- <img id="badge-picture" /> --> <!-- TODO -->
             
          </div>
          <div id="host-details" class="flex flex-col items-center content-center border rounded-lg shadow-sm bg-neutral-1">
            <p>{{accommodationOwner.name}} {{accommodationOwner.surname}}</p>
            <div>
              <p class="relative mt-1 left-1">Bio:</p>
              <p class="relative left-1 justify-normal">{{accommodationOwner.bio}}</p>
            </div>
            <br><br>
            <button class="btn-primary">{{("accommodation-card-details.contact-word" | translate)}}</button>
          </div>
        </div>
      </div>
      <!-------------------------------------------------------------------------------------------------------------------------------------------------->
      <div id="desc-availabilities-booknow-div" class="flex flex-row text-xl">
        <div id="description-and-availabilities-block" class="flex flex-col items-center justify-center align-middle">
          <div id="description-acc" class="flex flex-col items-start text-3xl bg-neutral-1">
            <p class="mb-3 text-lg font-bold text-center text-primary-light">{{("accommodation-card-details.description-word" | translate)}}:</p>
            <p>{{accommodation.description}}</p>
          </div>
          <div *ngIf="accommodation.availabilities && accommodation.availabilities.length > 0" id="availabilities-acc" class="mt-3 bg-neutral-1">
            <p class="mb-3 text-lg font-bold text-center text-primary-light">{{("accommodation-card-details.availabilities-word" | translate)}}:</p>
            <div>
              <app-choose-book-period-from-acc-details [accommodation]="accommodation" (sendChosenAvailability)="receiveAvailabilityFromChild($event)"></app-choose-book-period-from-acc-details>
            </div>
          </div>
        </div>
        <div *ngIf="accommodation.availabilities && accommodation.availabilities.length > 0" id="booknow-div-block-sticky" class="flex flex-col items-center justify-center bg-neutral-1">
          <div id="chk-in-chk-out" class="flex flex-row w-64 p-4 ml-6 border rounded-lg shadow-md bg-neutral-2 border-neutral-1">
            <div id="in" class="flex flex-col">
              <p class="mb-3 text-lg font-bold text-center text-primary-light">Check-In</p>
              <p>{{chosenAvailability?.start_date}}</p>
            </div>
            <div id="out" class="flex flex-col ml-3">
              <p class="mb-3 text-lg font-bold text-center text-primary-light">Check-Out</p>
              <p>{{chosenAvailability?.end_date}}</p>
            </div>
          </div>
          <div class="relative left-0 flex flex-row items-center p-4 mt-1 border rounded-lg shadow-md justify-normal bg-neutral-2 border-neutral-1">
            <label class="mr-3 align-middle label-primary" for="guests-number">{{("accommodation-card-details.guests-word" | translate)}}: </label>
            <input id="guests-number" class="align-middle" type="number" min="1" [max]="accommodation.beds" [(ngModel)]="guestsNumber" />
          </div>
          <p class="p-4 border rounded-lg shadow-md bg-neutral-2 border-neutral-1" id="calculus">{{chosenAvailability?.price_per_night}}€ x {{ nightsNumber$ | async}} {{("accommodation-card-details.nights-word" | translate)}} = {{ postOperation$ | async}} €</p>
          <button (click)="bookNow()" class="m-0 btn-primary">{{("accommodation-card-details.book-now" | translate)}}</button>
        </div>
      </div>

      <!-- SERVICES SECTION -->
      <!-------------------------------------------------------------------------------------------------------------------------------------------------->
      <div *ngIf="accommodation.services && accommodation.services.length > 0" class="mt-3">
        <img src="/assets/icons/pencil.png" (click)="toggleEditServicesPerspective()" *ngIf="isAdminOrMe" class="relative top-0 right-0 cursor-pointer w-7"/>
        <div class="flex flex-row justify-normal">

          <div id="single-service-block" *ngFor="let s of accommodation.services" class="flex flex-row mr-8">
            <img [src]="'/assets/' + s.icon_url" class="w-5" />
            <p class="ml-1">{{s.title}}</p>
          </div>

        </div>
      </div>
      <!-------------------------------------------------------------------------------------------------------------------------------------------------->
      <app-review-cards></app-review-cards>
    </div>
  </ng-container>
  
  <ng-container *ngIf="message">
    <button type="button" (click)="clearMessage()">clear</button>
    <br>
    <h1 class="text-xl text-blue-800">{{message}}</h1>
  </ng-container>
  
  <ng-template #editCityProvCountryTemplate>
    <div class="absolute transform -translate-x-1/2 -translate-y-1/2 border-4 border-solid border-primary-dark bg-neutral-2 top-1/2 left-1/2">
      <form #cityProvCountryForm="ngForm" class="m-5">
        <div class="flex flex-col items-center justify-center">

          <h1 class="text-2xl">Edit Address</h1>

          <div class="flex flex-row">
            <label class="label-primary" for="city-input-popup">City: </label>
            <div>
              <input class="input-primary" [(ngModel)]="cityInputField" name="city-input-popup" #cityInPopup="ngModel" id="city-input-popup" type="text" 
              [value]="accommodation.city ? accommodation.city : ('accommodation-card-details.city-placeholder-input-field' | translate)"
              pattern="^[a-zA-Z]+( [a-zA-Z]+)*$" />
              <div class="error-message" *ngIf="cityInPopup.invalid && (!cityInPopup.pristine && cityInPopup.dirty) && cityInPopup.hasError('pattern')">
                {{"accommodation-card-details.city-input-field-error" | translate}}
              </div>
            </div>
          </div>

          <div class="flex flex-row">
            <label class="label-primary" for="cap-input-popup">CAP: </label>
            <div>
              <input name="cap-input-popup" class="input-primary" [(ngModel)]="CAPInputField" #CAPInPopup="ngModel" id="cap-input-popup" type="text" 
              [value]="accommodation.cap" pattern="[0-9]{5}" required />
              <div class="error-message" *ngIf="CAPInPopup.invalid && (!CAPInPopup.pristine && CAPInPopup.dirty) && (CAPInPopup.hasError('pattern') || CAPInPopup.hasError('required'))">
                {{"accommodation-card-details.cap-input-field-error" | translate}}
              </div>
            </div>
          </div>

          <div class="flex flex-row">
            <label class="label-primary" for="street-input-popup">Street: </label>
            <div>
              <input name="street-input-popup" class="input-primary" [(ngModel)]="streetInputField" #streetInPopup="ngModel" id="street-input-popup" type="text" 
              [value]="accommodation.street ? accommodation.street : ('accommodation-card-details.street-placeholder-input-field' | translate)"
              pattern="^[a-zA-Z]+( [a-zA-Z]+)*$" />
              <div class="error-message" *ngIf="streetInPopup.invalid && (!streetInPopup.pristine && streetInPopup.dirty) && streetInPopup.hasError('pattern')">
                {{"accommodation-card-details.street-input-field-error" | translate}}
              </div>
            </div>
          </div>

          <div class="flex flex-row">
            <label class="label-primary" for="street-number-input-popup">Street Number: </label>
            <div>
              <input name="street-number-input-popup" class="input-primary" [(ngModel)]="strNumInputField" #streetNumInPopup="ngModel" id="street-number-input-popup" type="text" 
              [value]="accommodation.street_number ? accommodation.street_number : ('accommodation-card-details.street-number-placeholder-input-field' | translate)"
              pattern="[0-9]+[/]?[a-zA-Z]?" />
              <div class="error-message" *ngIf="streetNumInPopup.invalid && (!streetNumInPopup.pristine && streetNumInPopup.dirty) && streetNumInPopup.hasError('pattern')">
                {{"accommodation-card-details.street-number-input-field-error" | translate}}
              </div>
            </div>
          </div>
  
          <div class="flex flex-row">
            <label class="label-primary" for="prov-input-popup">Province: </label>
            <div>
              <input name="prov-input-popup" class="input-primary" [(ngModel)]="provinceInputField" #provInPopup="ngModel" id="prov-input-popup" type="text" 
              [value]="accommodation.province ? accommodation.province : ('accommodation-card-details.province-placeholder-input-field' | translate)"
              pattern="^[a-zA-Z]+( [a-zA-Z]+)*$" />
              <div class="error-message" *ngIf="provInPopup.invalid && (!provInPopup.pristine && provInPopup.dirty) && provInPopup.hasError('pattern')">
                {{"accommodation-card-details.province-input-field-error" | translate}}
              </div>
            </div>
          </div>
  
          <div class="flex flex-row">
            <label class="label-primary" for="country-input-popup">Country: </label>
            <div>
              <input name="country-input-popup" class="input-primary" [(ngModel)]="countryInputField" #countryInPopup="ngModel" id="country-input-popup" type="text" [value]="accommodation.country" required pattern="^[a-zA-Z]+( [a-zA-Z]+)*$" />
              <div class="error-message" *ngIf="countryInPopup.invalid && (!countryInPopup.pristine && countryInPopup.dirty) && (countryInPopup.hasError('pattern') || countryInPopup.hasError('required'))">
                {{"accommodation-card-details.country-input-field-error" | translate}}
              </div>
            </div>
          </div>
  
          <div class="flex flex-row items-center mt-6">
            <button class="mr-2 btn-primary" type="button" (click)="toggleEditCityProvCountry()" >{{("accommodation-card-details.close-btn-city-prov-country-form" | translate)}}</button>
            <button [disabled]="cityProvCountryForm.invalid" class="btn-primary" type="button" (click)="confirmFormCityCountryProv()" >{{("accommodation-card-details.submit-btn-city-prov-country-form" | translate)}}</button>
          </div>
        </div>
      </form>
    </div>
  </ng-template>
  
  <ng-container *ngIf="showEditCityProvCountry">
    <ng-container *ngTemplateOutlet="editCityProvCountryTemplate"></ng-container>
  </ng-container>

  <!-- TODO -->
  <ng-template #viewMorePhotos>

  </ng-template>

  <ng-container *ngIf="showViewMorePhotosPerspective">
    <ng-container *ngTemplateOutlet="viewMorePhotos"></ng-container>
  </ng-container>

  <ng-template #editRoomsBedsPerspective>
    <div class="absolute transform -translate-x-1/2 -translate-y-1/2 border-4 border-solid border-primary-dark bg-neutral-2 top-1/2 left-1/2">
      <form #roomsBedsForm="ngForm" class="m-5">
        <div class="flex flex-col items-center justify-center">

          <h1 class="text-2xl">Edit Rooms and Beds</h1>

          <div class="flex flex-row">
            <label class="label-primary" for="rooms-input-popup">Rooms: </label>
            <div>
              <input name="rooms-input-popup" class="input-primary" [(ngModel)]="roomsNum" #roomsInPopup="ngModel" id="rooms-input-popup" type="text" [value]="accommodation.rooms" required pattern="[1-9]+[0-9]*" />
              <div class="error-message" *ngIf="roomsInPopup.invalid && (!roomsInPopup.pristine && roomsInPopup.dirty) && (roomsInPopup.hasError('pattern') || roomsInPopup.hasError('required'))">
                {{"accommodation-card-details.rooms-input-field-error" | translate}}
              </div>
            </div>
          </div>
  
          <div class="flex flex-row">
            <label class="label-primary" for="beds-input-popup">Beds: </label>
            <div>
              <input name="beds-input-popup" class="input-primary" [(ngModel)]="bedsNum" #bedsInPopup="ngModel" id="beds-input-popup" type="text" [value]="accommodation.beds" required pattern="[1-9]+[0-9]*" />
              <div class="error-message" *ngIf="bedsInPopup.invalid && (!bedsInPopup.pristine && bedsInPopup.dirty) && (bedsInPopup.hasError('pattern') || bedsInPopup.hasError('required'))">
                {{"accommodation-card-details.beds-input-field-error" | translate}}
              </div>
            </div>
          </div>

          <div class="flex flex-row items-center mt-6">
            <button class="mr-2 btn-primary" type="button" (click)="toggleEditRoomsBeds()" >{{("accommodation-card-details.close-btn-city-prov-country-form" | translate)}}</button>
            <button [disabled]="roomsBedsForm.invalid" class="btn-primary" type="button" (click)="confirmFormRoomsBeds()" >{{("accommodation-card-details.submit-btn-city-prov-country-form" | translate)}}</button>
          </div>

        </div>
      </form>
    </div>
  </ng-template>

  <ng-container *ngIf="showViewEditRoomsBedsPerspective">
    <ng-container *ngTemplateOutlet="editRoomsBedsPerspective"></ng-container>
  </ng-container>

  <!-- TODO -->
  <ng-template #editPhotosPerspective>

  </ng-template>

  <ng-container *ngIf="showViewEditPhotosPerspective">
    <ng-container *ngTemplateOutlet="editPhotosPerspective"></ng-container>
  </ng-container>

  <ng-template #editServicesPerspective>
    <div id="edit-services-container" class="absolute bottom-0 flex flex-col transform -translate-x-1/2 -translate-y-1/2 border-8 border-solid w-[400px] bg-neutral-1 border-primary-dark left-64">
      <div class="relative bg-neutral-2">
        <p class="text-3xl label-primary">{{('accommodation-card-details.edit-services-sentence' | translate)}}</p>
        <p class="absolute text-2xl cursor-pointer top-1 right-1" (click)="toggleEditServicesPerspective()" id="close-popup">X</p>
      </div>
      <div id="search-and-selected-services" class="flex flex-row w-full">
        <div id="search-section" class="w-full">
          <input type="text" class="w-full text-xl text-center input-primary" #servicesBarInput (input)="searchServices(servicesBarInput.value)" />
          <div *ngIf="foundServices$ && foundServices$ | async as ser">
            <div *ngIf="ser.length > 0" class="flex flex-col items-center justify-center text-center align-middle border-4 border-solid border-secondary-light bg-neutral-2">
              <div *ngFor="let s of ser" class="flex flex-row w-full border-2 border-solid border-secondary-light">
                <input type="checkbox" [checked]="isSelectedService(s)" #checkBoxFoundService (input)="elaborateCheckbox(checkBoxFoundService.checked, s)" />
                <img [src]="'/assets/' + s.icon_url" class="w-5 ml-1" />
                <p class="ml-2">{{s.title}}</p>
              </div>
            </div>
          </div>
        </div>
        <div id="selected-services" class="flex flex-col ml-20 mr-20" *ngIf="selectedServicesView$ | async as servicesView">
          <div *ngIf="servicesView.length > 0">
            <div class="flex flex-row" *ngFor="let s of servicesView">
              <p class="text-2xl cursor-pointer" (click)="removeSelectedService(s)">X</p>
              <img [src]="'/assets/' + s.icon_url" class="w-5 ml-1" />
              <p class="ml-2">{{s.title}}</p>
            </div>
          </div>
        </div>
      </div>
      <!--METTERE QUI IL BOTTONE AL POSTO DI QUESTO COMMENTO-->
    </div>
  </ng-template>

  <ng-container *ngIf="showEditServicesPerspective">
    <ng-container *ngTemplateOutlet="editServicesPerspective"></ng-container>
  </ng-container>
  